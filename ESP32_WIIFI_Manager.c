/////////////////////////////////////////  LAB 3_1 Client ///////////////////////////////////////////
#include <WiFi.h>          // ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô WiFi ‡∏Å‡∏±‡∏ö ESP32

// ============================
// üìå ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÜ
// ============================

// üîê ‡∏ä‡∏∑‡πà‡∏≠ WiFi ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
const char* ssid     = "Elite_Ultimate_2.4G";
const char* password = "24776996";

// üåê ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP ‡πÅ‡∏ö‡∏ö Static IP
IPAddress local_IP(192, 168, 1, 200);
IPAddress gateway(192, 168, 1, 1);
IPAddress subnet(255, 255, 255, 0);
IPAddress primaryDNS(8, 8, 8, 8);
IPAddress secondaryDNS(8, 8, 4, 4);

// üïí ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi
unsigned long lastReconnectAttempt = 0;
const unsigned long reconnectInterval = 5000; // ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ms (‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)

// ============================
// üîÅ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Reconnect WiFi
// ============================
void reconnectWiFi() {
  if (WiFi.status() != WL_CONNECTED) {
    Serial.println("‚ö†Ô∏è WiFi ‡∏´‡∏•‡∏∏‡∏î! ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà...");
    WiFi.disconnect();  // ‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ clean
    WiFi.begin(ssid, password);
  }
}

// ============================
// ‚öôÔ∏è ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô setup()
// ============================
void setup() {
  Serial.begin(115200);             // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Serial Monitor

  // ‡∏•‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á Static IP ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡πÉ‡∏ä‡πâ DHCP ‡πÅ‡∏ó‡∏ô
  if (!WiFi.config(local_IP, gateway, subnet, primaryDNS, secondaryDNS)) {
    Serial.println("‚ùå ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Static IP ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÉ‡∏ä‡πâ DHCP ‡πÅ‡∏ó‡∏ô");
  }

  WiFi.begin(ssid, password);       // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi
  Serial.print("üîå ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi");

  // ‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
  int retry = 0;
  while (WiFi.status() != WL_CONNECTED && retry < 20) {
    delay(500);
    Serial.print(".");
    retry++;
  }

  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\n‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    Serial.print("üì° IP Address: ");
    Serial.println(WiFi.localIP());
  } else {
    Serial.println("\n‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi ‡πÑ‡∏î‡πâ");
  }
}

// ============================
// üîÅ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ß‡∏ô‡∏ã‡πâ‡∏≥‡πÉ‡∏ô loop()
// ============================
void loop() {
  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ WiFi ‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  if (millis() - lastReconnectAttempt >= reconnectInterval) {
    lastReconnectAttempt = millis();
    reconnectWiFi(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Reconnect ‡∏ñ‡πâ‡∏≤ WiFi ‡∏´‡∏•‡∏∏‡∏î
  }

  // üß™ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‡∏û‡∏¥‡∏°‡∏û‡πå IP ‡∏ó‡∏∏‡∏Å ‡πÜ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
  static unsigned long lastPrintTime = 0;
  if (millis() - lastPrintTime >= 10000) {
    lastPrintTime = millis();
    if (WiFi.status() == WL_CONNECTED) {
      Serial.print("üì° ‡∏¢‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà: ");
      Serial.println(WiFi.localIP());
    } else {
      Serial.println("üö´ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WiFi");
    }
  }
}
////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////// LAB 3_2 ///////////////////////////////////////////
#include <WiFi.h>
#include <WebServer.h>  // ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Web Server

// ============================
// üìå ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠ AP ‡πÅ‡∏•‡∏∞ IP Address
// ============================

const char* ssid = "ESP32_Hotspot";      // ‡∏ä‡∏∑‡πà‡∏≠ WiFi ‡∏ó‡∏µ‡πà ESP32 ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
const char* password = "12345678";       // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address ‡∏Ç‡∏≠‡∏á Access Point
IPAddress local_IP(192, 168, 4, 1);       // IP ‡∏Ç‡∏≠‡∏á ESP32 ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î AP
IPAddress gateway(192, 168, 4, 1);        // Gateway ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
IPAddress subnet(255, 255, 255, 0);       // Subnet mask

WebServer server(80); // ‡πÄ‡∏õ‡∏¥‡∏î Web Server ‡∏ó‡∏µ‡πà‡∏û‡∏≠‡∏£‡πå‡∏ï 80

// ============================
// üåê ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ Web Server ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
// ============================
void handleRoot() {
  server.send(200, "text/html", "<h1>üåê ESP32 Hotspot Active</h1><p>You are connected!</p>");
}

// ============================
// ‚öôÔ∏è ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô setup()
// ============================
void setup() {
  Serial.begin(115200);

  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ IP Address ‡∏Ç‡∏≠‡∏á AP
  WiFi.softAPConfig(local_IP, gateway, subnet);

  // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ ESP32 ‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô Access Point
  WiFi.softAP(ssid, password);

  Serial.println("üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á WiFi Hotspot ‡πÅ‡∏•‡πâ‡∏ß!");
  Serial.print("üì∂ SSID: ");
  Serial.println(ssid);
  Serial.print("üîë Password: ");
  Serial.println(password);
  Serial.print("üåê IP Address: ");
  Serial.println(WiFi.softAPIP());  // ‡πÅ‡∏™‡∏î‡∏á IP ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Web Server ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î path
  server.on("/", handleRoot);       // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö root "/"
  server.begin();
  Serial.println("üåç Web server ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
}

// ============================
// üîÅ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ß‡∏ô‡∏£‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å client
// ============================
void loop() {
  server.handleClient();  // ‡∏£‡∏≠ client ‡∏°‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
}
////////////////////////////////////////////////////////////////////////////////////
